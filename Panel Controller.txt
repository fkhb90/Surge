/**
 * Surge Panel Script for FP-Shield V10.13
 * * åŠŸèƒ½ï¼š
 * 1. é¡¯ç¤ºç•¶å‰æŒ‡ç´‹é˜²è­·ç‹€æ…‹ã€‚
 * 2. é»æ“Šé¢æ¿åœ–ç¤ºæ™‚ï¼Œåˆ‡æ›ç‹€æ…‹ (Persistent Store)ã€‚
 */

(function() {
    // 1. å®šç¾©ç‹€æ…‹è®Šæ•¸
    // protect: é˜²è­·æ¨¡å¼ (é è¨­)
    // shopping: è³¼ç‰©æ¨¡å¼ (åœæ­¢å½è£)
    const KEY = "FP_MODE";
    let mode = $persistentStore.read(KEY);
    
    // åˆå§‹åŒ–ï¼šè‹¥ç„¡è¨­å®šå‰‡é è¨­ç‚ºé˜²è­·æ¨¡å¼
    if (!mode) {
        mode = "protect";
        $persistentStore.write(mode, KEY);
    }

    // 2. è™•ç†é»æ“Šäº‹ä»¶
    if ($trigger === "button") {
        mode = (mode === "protect") ? "shopping" : "protect";
        $persistentStore.write(mode, KEY);
    }

    // 3. æ¸²æŸ“ UI
    // å®šç¾©é¡¯ç¤ºå…§å®¹
    const isProtect = (mode === "protect");
    const title = isProtect ? "ğŸ›¡ï¸ æŒ‡ç´‹é˜²è­·: é–‹å•Ÿ" : "ğŸ›’ è³¼ç‰©æ¨¡å¼: æ´»èº";
    const content = isProtect 
        ? "æ¨¡æ“¬ MacOS ç’°å¢ƒ | WebRTC é˜»æ–·ä¸­" 
        : "åŸå§‹ iOS ç’°å¢ƒ | é©ç”¨æ–¼ç¶²éŠ€/æ”¯ä»˜";
    const icon = isProtect ? "lock.shield.fill" : "cart.fill";
    const iconColor = isProtect ? "#34C759" : "#FF9500"; // Green vs Orange

    $done({
        title: title,
        content: content,
        icon: icon,
        "icon-color": iconColor
    });
})();